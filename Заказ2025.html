<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –ó–≤—ñ—Ç—ñ–≤ –ø–æ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö</title>
    <style>
        /* ==================== –°–¢–ò–õ–Ü ==================== */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        header { text-align: center; margin-bottom: 20px; }
        .container { max-width: 1250px; margin: auto; display: flex; gap: 20px; }
        .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex: 1; }
        
        #order-form label { display: block; margin-top: 10px; font-weight: bold; }
        #order-form input { width: calc(100% - 22px); padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; }
        
        .add-item-btn { background-color: #28a745; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 5px; }
        .add-item-btn:hover { background-color: #218838; }

        #order-form button[type="submit"] { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px; font-size: 16px; width: 100%; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #e2e2e2; }
        
        .action-button { padding: 5px 10px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; }
        .edit-btn { background-color: #ffc107; }
        .delete-btn { background-color: #dc3545; color: white; }
        .print-btn { background-color: #17a2b8; color: white; }
        .summary-print-btn { background-color: #009688; color: white; margin-top: 10px; }
        
        @media print {
            body > *:not(.print-content) { display: none; }
            .print-content { display: block; position: absolute; top: 0; left: 0; width: 100%; }
            .print-content table { border: 2px solid black; width: 100%; }
            .print-content th, .print-content td { border: 1px solid black; padding: 8px; }
        }
    </style>
</head>
<body>

    <header>
        <h1>–°–∏—Å—Ç–µ–º–∞ –û–±–ª—ñ–∫—É —Ç–∞ –ó–≤—ñ—Ç—ñ–≤ –ó–∞–º–æ–≤–ª–µ–Ω—å</h1>
    </header>

    <div class="container">
        <div id="seller-section" class="section">
            <h2>–ü—Ä–æ–¥–∞–≤–µ—Ü—å: –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
            
            <form id="order-form">
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 2;">
                        <label>–ü—Ä—ñ–∑–≤–∏—â–µ/–Ü–º'—è –ö–ª—ñ—î–Ω—Ç–∞:</label>
                        <input type="text" id="client-name" required>
                    </div>
                    <div style="flex: 1;">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                        <input type="tel" id="client-phone">
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label>–î–∞—Ç–∞ –í–∏–∫–æ–Ω–∞–Ω–Ω—è:</label>
                        <input type="date" id="execution-date" required>
                    </div>
                    <div style="flex: 1;">
                        <label>–ì–æ–¥–∏–Ω–∞:</label>
                        <input type="time" id="execution-time">
                    </div>
                </div>
                
                <h3 style="margin-top: 20px;">–ü–æ–∑–∏—Ü—ñ—ó –°—Ç—Ä–∞–≤–∏</h3>

                <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end; background: #f9f9f9; padding: 10px; border-radius: 5px;">
                    <div style="flex: 2; min-width: 200px;">
                        <label>–°—Ç—Ä–∞–≤–∞:</label>
                        <input type="text" id="new-dish-name" list="dish-suggestions" placeholder="–ù–∞–∑–≤–∞">
                        <datalist id="dish-suggestions"></datalist>
                    </div>
                    <div style="flex: 2; min-width: 150px;">
                        <label>–ö–æ–º–µ–Ω—Ç–∞—Ä:</label>
                        <input type="text" id="new-dish-comment" placeholder="–ù–∞–ø—Ä. –±–µ–∑ —Å–æ–ª—ñ">
                    </div>
                    <div style="flex: 0.5; min-width: 80px;">
                        <label>–ö-—Å—Ç—å:</label>
                        <input type="number" id="new-quantity" min="1" value="1">
                    </div>
                    <div style="flex: 0.5; min-width: 80px;">
                        <label>–¶—ñ–Ω–∞:</label>
                        <input type="number" id="new-price" min="0" placeholder="0">
                    </div>
                    <button type="button" class="add-item-btn" onclick="addItemToCurrentOrder()">–î–æ–¥–∞—Ç–∏</button>
                </div>

                <table id="items-table">
                    <thead>
                        <tr>
                            <th>–°—Ç—Ä–∞–≤–∞</th>
                            <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
                            <th>–ö-—Å—Ç—å</th>
                            <th>–¶—ñ–Ω–∞</th>
                            <th>–î—ñ—è</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                
                <button type="submit" id="submit-order-btn">–ó–±–µ—Ä–µ–≥—Ç–∏ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
            </form>

            <h3 style="margin-top: 30px;">–í—Å—ñ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
            <div id="all-orders-list"></div>
        </div>

        <div id="chef-section" class="section">
            <h2>–ö—É—Ö–∞—Ä: –ó–≤—ñ—Ç–∏</h2>
            <div class="report-filter">
                <label>–û–±—Ä–∞—Ç–∏ –î–∞—Ç—É:</label>
                <input type="date" id="report-date">
                <button class="add-item-btn" onclick="renderReports()">–û–Ω–æ–≤–∏—Ç–∏ –ó–≤—ñ—Ç–∏</button>
            </div>
            
            <h3>1. –ó–≤–µ–¥–µ–Ω–∏–π –ó–≤—ñ—Ç (–ó–∞–≥–∞–ª—å–Ω—ñ –û–±—Å—è–≥–∏)</h3>
            <div id="summary-report"></div>
            <button id="print-summary-btn" class="action-button summary-print-btn" onclick="printSummaryReport()" style="display:none;">–î—Ä—É–∫—É–≤–∞—Ç–∏ –ó–≤–µ–¥–µ–Ω–∏–π –ó–≤—ñ—Ç</button>

            <h3>2. –î–µ—Ç–∞–ª—å–Ω—ñ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
            <div id="client-report"></div>
        </div>
    </div>
    
    <div id="print-area" class="print-content" style="display: none;"></div>

<script>
    const STORAGE_KEY = 'clientOrders_v4'; 
    const DISH_HISTORY_KEY = 'dishHistory'; 
    let currentOrderItems = []; 

    function loadOrders() {
        const json = localStorage.getItem(STORAGE_KEY);
        return json ? JSON.parse(json) : [];
    }

    function saveOrders(orders) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(orders));
    }

    window.addItemToCurrentOrder = function() {
        const dishInput = document.getElementById('new-dish-name');
        const commentInput = document.getElementById('new-dish-comment');
        const qtyInput = document.getElementById('new-quantity');
        const priceInput = document.getElementById('new-price');
        
        if (!dishInput.value.trim()) return;

        currentOrderItems.push({
            dishName: dishInput.value.trim(),
            comment: commentInput.value.trim(),
            quantity: parseInt(qtyInput.value) || 1,
            price: parseFloat(priceInput.value) || 0
        });
        
        renderCurrentOrderItems();
        dishInput.value = '';
        commentInput.value = '';
        qtyInput.value = 1;
        priceInput.value = '';
        dishInput.focus();
    };

    function renderCurrentOrderItems() {
        const tbody = document.getElementById('items-table').querySelector('tbody');
        tbody.innerHTML = '';
        currentOrderItems.forEach((item, index) => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${item.dishName}</td>
                <td style="color: #666; font-style: italic;">${item.comment || '-'}</td>
                <td>${item.quantity}</td>
                <td>${item.price || '-'}</td>
                <td><button type="button" class="delete-btn action-button" onclick="currentOrderItems.splice(${index},1);renderCurrentOrderItems();">–•</button></td>
            `;
        });
    }

    document.getElementById('order-form').addEventListener('submit', function(e) {
        e.preventDefault();
        if (currentOrderItems.length === 0) return alert("–î–æ–¥–∞–π—Ç–µ —Å—Ç—Ä–∞–≤–∏!");
        
        let orders = loadOrders();
        const orderId = this.dataset.editingId;
        const orderData = {
            id: orderId || Date.now().toString(),
            clientName: document.getElementById('client-name').value,
            clientPhone: document.getElementById('client-phone').value,
            executionDate: document.getElementById('execution-date').value,
            executionTime: document.getElementById('execution-time').value,
            items: [...currentOrderItems]
        };

        if (orderId) {
            const idx = orders.findIndex(o => o.id === orderId);
            orders[idx] = orderData;
        } else {
            orders.push(orderData);
        }

        saveOrders(orders);
        this.reset();
        delete this.dataset.editingId;
        currentOrderItems = [];
        renderCurrentOrderItems();
        renderAllOrders();
        renderReports();
    });

    function renderAllOrders() {
        const orders = loadOrders();
        const container = document.getElementById('all-orders-list');
        container.innerHTML = `
            <table>
                <thead><tr><th>–ß–∞—Å</th><th>–ö–ª—ñ—î–Ω—Ç</th><th>–î—ñ—ó</th></tr></thead>
                <tbody>
                    ${orders.map(o => `
                        <tr>
                            <td>${o.executionTime || '--'}</td>
                            <td>${o.clientName}</td>
                            <td>
                                <button class="action-button edit-btn" onclick="editOrder('${o.id}')">‚úèÔ∏è</button>
                                <button class="action-button delete-btn" onclick="deleteOrder('${o.id}')">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }

    window.editOrder = function(id) {
        const o = loadOrders().find(o => o.id === id);
        document.getElementById('client-name').value = o.clientName;
        document.getElementById('client-phone').value = o.clientPhone;
        document.getElementById('execution-date').value = o.executionDate;
        document.getElementById('execution-time').value = o.executionTime;
        currentOrderItems = [...o.items];
        renderCurrentOrderItems();
        document.getElementById('order-form').dataset.editingId = id;
        document.getElementById('submit-order-btn').textContent = "–û–Ω–æ–≤–∏—Ç–∏ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è";
    };

    window.deleteOrder = function(id) {
        if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏?")) {
            saveOrders(loadOrders().filter(o => o.id !== id));
            renderAllOrders();
            renderReports();
        }
    };

    window.renderReports = function() {
        const date = document.getElementById('report-date').value;
        const orders = loadOrders().filter(o => o.executionDate === date);
        orders.sort((a,b) => (a.executionTime || '99:99').localeCompare(b.executionTime || '99:99'));

        const summaryCont = document.getElementById('summary-report');
        const clientCont = document.getElementById('client-report');
        
        if (orders.length === 0) {
            summaryCont.innerHTML = "–ù–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å";
            clientCont.innerHTML = "";
            document.getElementById('print-summary-btn').style.display = 'none';
            return;
        }

        document.getElementById('print-summary-btn').style.display = 'block';
        
        // –ó–≤–µ–¥–µ–Ω–∏–π –∑–≤—ñ—Ç
        const sum = {};
        orders.flatMap(o => o.items).forEach(i => sum[i.dishName] = (sum[i.dishName] || 0) + i.quantity);
        summaryCont.innerHTML = `<table>${Object.entries(sum).map(([n, q]) => `<tr><td>${n}</td><td><b>${q}</b></td></tr>`).join('')}</table>`;

        // –î–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç
        clientCont.innerHTML = orders.map(o => `
            <div style="border:1px solid #ddd; margin: 10px 0; padding: 10px;">
                <b>${o.executionTime || '--:--'} - ${o.clientName}</b> (${o.clientPhone || '–±–µ–∑ —Ç–µ–ª.'})
                <button class="action-button print-btn" style="float:right" onclick="printOrder('${o.id}')">–î—Ä—É–∫</button>
                <table>
                    ${o.items.map(i => `<tr><td>${i.dishName}</td><td>${i.comment || ''}</td><td>${i.quantity}</td></tr>`).join('')}
                </table>
            </div>
        `).join('');
    };

    window.printOrder = function(id) {
        const o = loadOrders().find(o => o.id === id);
        const area = document.getElementById('print-area');
        area.innerHTML = `
            <h2>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${o.clientName}</h2>
            <p>–î–∞—Ç–∞: ${o.executionDate} | –ß–∞—Å: ${o.executionTime || '--:--'} | –¢–µ–ª: ${o.clientPhone || '-'}</p>
            <table>
                <tr><th>–°—Ç—Ä–∞–≤–∞</th><th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th><th>–ö-—Å—Ç—å</th></tr>
                ${o.items.map(i => `<tr><td>${i.dishName}</td><td>${i.comment || ''}</td><td>${i.quantity}</td></tr>`).join('')}
            </table>
        `;
        area.style.display = 'block';
        window.print();
        area.style.display = 'none';
    };

    window.printSummaryReport = function() {
        const date = document.getElementById('report-date').value;
        const orders = loadOrders().filter(o => o.executionDate === date);
        const sum = {};
        orders.flatMap(o => o.items).forEach(i => sum[i.dishName] = (sum[i.dishName] || 0) + i.quantity);
        
        const area = document.getElementById('print-area');
        area.innerHTML = `<h2>–ó–≤–µ–¥–µ–Ω–∏–π –∑–≤—ñ—Ç –Ω–∞ ${date}</h2><table>
            <tr><th>–°—Ç—Ä–∞–≤–∞</th><th>–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å</th></tr>
            ${Object.entries(sum).map(([n, q]) => `<tr><td>${n}</td><td>${q}</td></tr>`).join('')}
        </table>`;
        area.style.display = 'block';
        window.print();
        area.style.display = 'none';
    };

    document.addEventListener('DOMContentLoaded', () => {
        const d = new Date().toISOString().split('T')[0];
        document.getElementById('execution-date').value = d;
        document.getElementById('report-date').value = d;
        renderAllOrders();
        renderReports();
    });
</script>
</body>
</html>